<?xml version="1.0" encoding="UTF-8" ?>
<configuration>
	<loglevel>info</loglevel>
	<version>1.1</version>
	<constants>
		<pole1length>0.4</pole1length>
		<pole2length>0.4</pole2length>
		<poleradius>0.02</poleradius>
		<baselength>0.4</baselength>
		<wheelradius>0.05</wheelradius>
		<basethickness>0.02</basethickness>
		<lynoleum>0</lynoleum>
		<rubber>1</rubber>
		<glass>2</glass>
		<basemass>2</basemass>
		<wheelmass>0.5</wheelmass>
		<pole1mass>0.1</pole1mass>
		<pole2mass>0.1</pole2mass>
		<irrelevantmass>0.001</irrelevantmass>
		<irrelevantinertia>0.001</irrelevantinertia>
		<fallangle>0.45*_pi</fallangle>
		<maxtorque>3</maxtorque>
		<maxinitangle>0.025*_pi</maxinitangle>
		<timereward>1</timereward>
		<fallreward>-100</fallreward>
	</constants>
	<policy>
		<trialTimeoutSeconds>20.0</trialTimeoutSeconds>
		
		<termination>
			<expression>(abs(robot.pole1joint.angle) >= fallangle) ||
			            (abs(robot.pole2joint.angle) >= fallangle)</expression>
		</termination>
		<reward>
			<expression>timereward +
 			            fallreward  * ((abs(robot.pole1joint.angle) >= fallangle) ||
			                           (abs(robot.pole2joint.angle) >= fallangle))
			</expression>
			<min>fallreward</min>
			<max>timereward</max>
		</reward>

		<statevar comment="pole 1 angle">
			<expression>robot.pole1joint.angle+_pi</expression>
			<min>0</min>
			<max>2*_pi</max>
		</statevar>
		<statevar comment="pole 1 angle rate">
			<expression>robot.pole1joint.anglerate</expression>
			<min>-10*_pi</min>
			<max>10*_pi</max>
		</statevar>
		<statevar comment="pole 2 angle">
			<expression>robot.pole2joint.angle+_pi</expression>
			<min>0</min>
			<max>2*_pi</max>
		</statevar>
		<statevar comment="pole 2 angle rate">
			<expression>robot.pole2joint.anglerate</expression>
			<min>-10*_pi</min>
			<max>10*_pi</max>
		</statevar>
		
		<actionvar comment="motor torque">
		    <variable>robot.motorjoint.torque</variable>
		    <expression>x</expression>
		    <min>-maxtorque</min>
		    <max>maxtorque</max>
		</actionvar>
	</policy>
	<ode>
		<globalK>3.3E6</globalK>
		<globalD>0.0</globalD>
		<gravityZ>-9.81</gravityZ>
		<steptime>0.05</steptime>
		<subsamplingfactor>10</subsamplingfactor>
		<object>
			<name>robot</name>
			<drawbodies>true</drawbodies>
			<drawcoms>true</drawcoms>
			<drawgeoms>true</drawgeoms>
			
			<initialcondition>
				<bodyname>pole1</bodyname>
				<rotation>
					<axis>
						<x>1</x>
						<y>0</y>
						<z>0</z>
					</axis>
					<angle>x*2*maxinitangle-maxinitangle</angle>
				</rotation>
			</initialcondition>
			<initialcondition>
				<bodyname>pole2</bodyname>
				<rotation>
					<axis>
						<x>1</x>
						<y>0</y>
						<z>0</z>
					</axis>
					<angle>x*2*maxinitangle-maxinitangle</angle>
				</rotation>
			</initialcondition>
			<initialcondition>
				<bodyname>base</bodyname>
				<rotation>
					<axis>
						<x>1</x>
						<y>0</y>
						<z>0</z>
					</axis>
					<angle>0</angle>
				</rotation>
			</initialcondition>
			<initialcondition>
				<bodyname>wheel</bodyname>
				<rotation>
					<axis>
						<x>1</x>
						<y>0</y>
						<z>0</z>
					</axis>
					<angle>0</angle>
				</rotation>
			</initialcondition>
			<body>
				<name>base</name>
				<mass>basemass</mass>
				<IXX>(1/12)*basemass*(baselength^2+basethickness^2)</IXX>
				<IYY>(1/12)*basemass*(baselength^2+basethickness^2)</IYY>
				<IZZ>(1/12)*basemass*(baselength^2+baselength^2)</IZZ>
				<anchor>
					<name>wheel</name>
					<x>0</x>
					<y>0</y>
					<z>0</z>
				</anchor>
				<anchor>
					<name>pole1</name>
					<x>-baselength/2</x>
					<y>0</y>
					<z>0</z>
				</anchor>
				<drawinfo>
					<box comment="base">
						<color>
							<r>0.1</r>
							<g>0.1</g>
							<b>0.8</b>
						</color>
						<dx>baselength</dx>
						<dy>baselength</dy>
						<dz>basethickness</dz>
					</box>
				</drawinfo>
			</body>
			<body>
				<name>wheel</name>
				<mass>wheelmass</mass>
				<IXX>(1/2)*wheelmass*wheelradius^2</IXX>
				<IYY>(1/12)*wheelmass*(3*wheelradius^2+baselength^2)</IYY>
				<IZZ>(1/12)*wheelmass*(3*wheelradius^2+baselength^2)</IZZ>
				<anchor>
					<name>base</name>
					<x>0</x>
					<y>0</y>
					<z>0</z>
				</anchor>
			</body>
			<body>
				<name>pole1</name>
				<mass>pole1mass</mass>
				<IXX>(1/12)*pole1mass*(3*poleradius^2+pole1length^2)</IXX>
				<IYY>(1/12)*pole1mass*(3*poleradius^2+pole1length^2)</IYY>
				<IZZ>(1/2)*pole1mass*poleradius^2</IZZ>
				<anchor>
					<name>base</name>
					<x>0</x>
					<y>0</y>
					<z>-pole1length/2</z>
				</anchor>
				<anchor>
					<name>pole2</name>
					<x>0</x>
					<y>0</y>
					<z>pole1length/2</z>
				</anchor>
				<drawinfo>
					<box comment="pole">
						<color>
							<r>0.1</r>
							<g>0.1</g>
							<b>0.8</b>
						</color>
						<dx>poleradius</dx>
						<dy>poleradius</dy>
						<dz>pole1length</dz>
					</box>
				</drawinfo>
			</body>
			<body>
				<name>pole2</name>
				<mass>pole2mass</mass>
				<IXX>(1/12)*pole2mass*(3*poleradius^2+pole2length^2)</IXX>
				<IYY>(1/12)*pole2mass*(3*poleradius^2+pole2length^2)</IYY>
				<IZZ>(1/2)*pole2mass*poleradius^2</IZZ>
				<anchor>
					<name>pole1</name>
					<x>0</x>
					<y>0</y>
					<z>-pole2length/2</z>
				</anchor>
				<drawinfo>
					<box comment="pole">
						<color>
							<r>0.1</r>
							<g>0.8</g>
							<b>0.1</b>
						</color>
						<dx>poleradius</dx>
						<dy>poleradius</dy>
						<dz>pole2length</dz>
					</box>
				</drawinfo>
			</body>
			<joint>
				<name>motorjoint</name>
				<type>hinge</type>
				<anchor1>
					<bodyname>base</bodyname>
					<anchorname>wheel</anchorname>
				</anchor1>
				<anchor2>
					<bodyname>wheel</bodyname>
					<anchorname>base</anchorname>
				</anchor2>
				<axisX>1</axisX>
				<axisY>0</axisY>
				<axisZ>0</axisZ>
				<motor>
					<type>torque</type>
					<lineardamping>0.08</lineardamping>
				</motor>
			</joint>
			<joint>
				<name>pole1joint</name>
				<type>hinge</type>
				<anchor1>
					<bodyname>base</bodyname>
					<anchorname>pole1</anchorname>
				</anchor1>
				<anchor2>
					<bodyname>pole1</bodyname>
					<anchorname>base</anchorname>
				</anchor2>
				<axisX>1</axisX>
				<axisY>0</axisY>
				<axisZ>0</axisZ>
			</joint>
			<joint>
				<name>pole2joint</name>
				<type>hinge</type>
				<anchor1>
					<bodyname>pole1</bodyname>
					<anchorname>pole2</anchorname>
				</anchor1>
				<anchor2>
					<bodyname>pole2</bodyname>
					<anchorname>pole1</anchorname>
				</anchor2>
				<axisX>1</axisX>
				<axisY>0</axisY>
				<axisZ>0</axisZ>
			</joint>
			<fixedpoint>
				<bodyname>base</bodyname>
				<bodyX>0</bodyX>
				<bodyY>0</bodyY>
				<bodyZ>0</bodyZ>
				<worldX>0</worldX>
				<worldY>0</worldY>
				<worldZ>wheelradius</worldZ>
			</fixedpoint>
			<geom>
				<name>wheel</name>
				<bodyname>wheel</bodyname>
				<type>cylinder</type>
				<material>rubber</material>
				<radius>wheelradius</radius>
				<length>baselength</length>
				<x>0</x>				
				<y>0</y>
				<z>0</z>				
				<rotation>
					<axis>
						<x>0</x>
						<y>1</y>
						<z>0</z>
					</axis>
					<angle>0.5*_pi</angle>
				</rotation>
			</geom>
			<geom>
				<name>ball1</name>
				<bodyname>base</bodyname>
				<type>sphere</type>
				<material>glass</material>
				<radius>wheelradius</radius>
				<x>0</x>				
				<y>-baselength/2</y>
				<z>0</z>
			</geom>
			<geom>
				<name>ball2</name>
				<bodyname>base</bodyname>
				<type>sphere</type>
				<material>glass</material>
				<radius>wheelradius</radius>
				<length></length>
				<x>0</x>				
				<y>baselength/2</y>
				<z>0</z>				
			</geom>
		</object>
		<object>
			<name>floor</name>
			<geom>
				<name>surface</name>
				<type>plane</type>
				<material>lynoleum</material>
				<A>0</A>
				<B>0</B>
				<C>1</C>
				<D>0</D>		
			</geom>	
		</object>
		<collisions>
			<drawcontacts>false</drawcontacts>
			<contact>
				<material1>lynoleum</material1>
				<material2>rubber</material2>
				<K>6000</K>
				<D>300</D>
				<mu>1000</mu>
				<approximation comment="1 means friction pyramid approximation">1</approximation>
			</contact>
			<contact>
				<material1>lynoleum</material1>
				<material2>glass</material2>
				<K>6000</K>
				<D>300</D>
				<mu>0</mu>
			</contact>
			<collision>
				<object1>floor</object1>
				<object2>robot</object2>
			</collision>
		</collisions>
	</ode>
</configuration>

